<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.start.webBack.mapper.UserReportsMapper">
	
	<!-- <cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> -->
	
	<select id="selectoper" parameterType="String"
		resultType="String">
		SELECT 
				OPERATORNAME 
		FROM 
				OPERATORINFO 
		WHERE 
				OPERATORID = #{operatorid}
	</select>
	
	<!-- 充电记录总数 自己的桩自己的卡 -->
	<select id="getAllCount" parameterType="FindreportsDto" resultType="Int">
		SELECT 
				count(*) 
		FROM 	(
				SELECT 
				  		  UCORD.TRANSATIONID,
				  		  CPUSER.CPUSERID,
						  CPUSER.CPUSERNAME,
						  CPUSER.TELEPHONE,
						   0 IDENTITYCARDNUM,
						  CPUSER.PLATENUMBER,
						  CASE UMCORD.DEDUCTSUCCESSFLAG
							WHEN 0 THEN '失败'
							ELSE '成功'
							 END DEDUCTSUCCESSFLAG,
						  CS.CSNAME,
						  UCORD.DEVICEID,
						  UCORD.CHARGEMETHODID,
						  CHM.CHARGEMETHODNAME,
						  UCORD.CHARGEMODEID,
						  CMD.CHARGEMODENAME,
						  UCORD.CHARGEENDCAUSE,
						  UCORD.CHARGEQUANTITY,
						  CS.CSID,
						  CP.CPID,
						  CO.OPERATORID,
						  CP.CPNAME,
						  UMCORD.CHARGEMONEY,
						  UMCORD.SERVICETIP,
						  UMCORD.DEDUCTMONEY,
						  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
						  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
						  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
						  (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM,
						  UMCORD.REMAINMONEY,
						  CPUSER.VIN
			FROM  
						  USERCHARGERECORD UCORD,
				 		 CPUSERINFO CPUSER,
				 		 USERDEDUCTMONEYRECORD UMCORD,
				 		 CPINFO CP,
				 		 CHARGEMODE CMD,
						  OPERATORINFO CO,
						  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
					CP.OPERATORID = CO.OPERATORID
			AND
					CPUSER.CPUSERID = UCORD.CPUSERID
		    AND 
		    		UMCORD.CPUSERID = UCORD.CPUSERID
		    AND 
		    		UCORD.CPID = CP.CPID
		    AND 
		    		CP.CSID = CS.CSID
		    AND 
		    		CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND 
		    		CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		     AND 
		     		FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND 
		    		UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		    AND  
					UCORD.CHARGEMETHODID =0
		    UNION ALL
		    
		    SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  UCORD.CARDNUM CPUSERID,
				  CARDUSER.CARDUSERNAME CPUSERNAME,
				  CARDUSER.TELEPHONE,
				  CARDUSER.IDENTITYCARDNUM,
				  CARDUSER.PLATENUM PLATENUMBER,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.OPERATORID,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM,
				  UMCORD.REMAINMONEY,
				  CARDUSER.VIN
			FROM 
					USERCHARGERECORD UCORD,
				  	CARDUSERINFO CARDUSER,
				  	USERDEDUCTMONEYRECORD UMCORD,
				  	CPINFO CP,
				  	OPERATORINFO CO,
				  	CHARGEMODE CMD,
				  	CSINFO CS,
				  	CHARGEMETHOD CHM
			WHERE 	
					CP.OPERATORID = CO.OPERATORID
			AND
					CARDUSER.OPERATORID = CO.OPERATORID 
			AND
					CARDUSER.CARDNUM = UCORD.CARDNUM
		    AND 
		    		UMCORD.CPUSERID = UCORD.CPUSERID
		    AND 	
		    		UCORD.CPID = CP.CPID
		    AND 
		    		CP.CSID = CS.CSID
		    AND 
		    		CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND 
		    		CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND 
		    		FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND 
		    		UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		    AND  
					UCORD.CHARGEMETHODID =1
			) A
			WHERE 1=1
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="OPERATORID!=null and OPERATORID!=''">
			AND 
					A.OPERATORID = #{OPERATORID}
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
	</select>
	
	<!-- 扫码用户总数 -->
	<select id="getCount" parameterType="FindreportsDto" resultType="Int">
		SELECT COUNT(*) FROM (SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  UCORD.CARDNUM,
				  CPUSER.CPUSERNAME,
				  CPUSER.TELEPHONE,
				  UMCORD.DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  CP.CPID,
				  CO.OPERATORID,
				  CP.CPNAME,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  UCORD.CHARGEMONEY,
				  UCORD.CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  UCORD.CHARGETIMESPAN,
				  CPUSER.ACCOUNTSUM,
				  UMCORD.REMAINMONEY,
				  CPUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CPUSERINFO CPUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,
				  CHARGEMETHOD CHM
			WHERE 
			CO.OPERATORID = CP.OPERATORID
			AND
			CPUSER.CPUSERID = UCORD.CPUSERID
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID) A
		    WHERE A.CHARGEMETHODID = 0
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="OPERATORID!=null and OPERATORID!=''">
			AND 
					A.OPERATORID = #{OPERATORID}
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>
	</select>
	
	<!-- 刷卡用户总数 -->
	<select id="getCardCount" parameterType="FindreportsDto" resultType="Int">
		SELECT 
				COUNT(*) 
		FROM 
				(
				SELECT 
						DISTINCT UCORD.TRANSATIONID,
				  		UCORD.CARDNUM,
						CARDUSER.CARDUSERNAME CPUSERNAME,
						CARDUSER.TELEPHONE,
						CARDUSER.IDENTITYCARDNUM,
						CASE UMCORD.DEDUCTSUCCESSFLAG
						WHEN 0 THEN '失败'
						ELSE '成功'
						END DEDUCTSUCCESSFLAG,
						CS.CSNAME,
						UCORD.DEVICEID,
						UCORD.CHARGEMETHODID,
						CHM.CHARGEMETHODNAME,
						UCORD.CHARGEMODEID,
						CMD.CHARGEMODENAME,
						UCORD.CHARGEENDCAUSE,
						UCORD.CHARGEQUANTITY,
						CS.CSID,
 						CP.CPID,
 						CO.OPERATORID,
 						CP.CPNAME,
 						UCORD.CHARGEMONEY,
					  	LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
					  	FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
					  	UCORD.CHARGETIMESPAN,
					  	(UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM,
					  	UMCORD.REMAINMONEY,
					  	CARDUSER.VIN
				FROM 	
						USERCHARGERECORD UCORD,
				  		CARDUSERINFO CARDUSER,
				  		OPERATORINFO CO,
				  		USERDEDUCTMONEYRECORD UMCORD,
				 		CPINFO CP,CHARGEMODE CMD,
				  		CSINFO CS,CHARGEMETHOD CHM
				WHERE 
						CP.OPERATORID = co.OPERATORID
				AND
						CARDUSER.OPERATORID = CO.OPERATORID
				AND
						CARDUSER.CARDNUM = UCORD.CARDNUM
			    AND 
			    		UMCORD.CPUSERID = UCORD.CPUSERID
			    AND
			     		UCORD.CPID = CP.CPID
			    AND 
			    		CP.CSID = CS.CSID
			    AND 
			    		CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
			    AND 
			    		CMD.CHARGEMODEID = UCORD.CHARGEMODEID
			    AND 
			    		UCORD.TRANSATIONID = UMCORD.TRANSATIONID
			    AND 
			    		FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))) A
	    WHERE 
	    		A.CHARGEMETHODID = 1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
		AND 
				A.CPUSERNAME LIKE '%${CPUSERNAME}%'
		</if>
		<if test="OPERATORID!=null and OPERATORID!=''">
		AND 
				A.OPERATORID = #{OPERATORID}
		</if>
		<if test="TELEPHONE!=null and TELEPHONE!=''">
		AND 
				A.TELEPHONE LIKE '%${TELEPHONE}%'
		</if>
		<if test="FROMDATE!=null and FROMDATE!=''">
	    AND
				 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
		</if>
		<if test="TODATE!=null and TODATE!=''">
		AND
				 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
		</if>
	</select>
	
	<!-- all用户信息-->
	<select id="selectAllByPage" parameterType="FindreportsDto"
		resultType="userReportsDto">
		SELECT * FROM (SELECT 
				  UCORD.TRANSATIONID,
				  CPUSER.CPUSERID,
				  CPUSER.CPUSERNAME,
				  CPUSER.TELEPHONE,
				  0 IDENTITYCARDNUM,
				  CPUSER.PLATENUMBER,				
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.OPERATORID,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				 
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  UMCORD.REMAINMONEY,
				  CPUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CPUSERINFO CPUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
					CO.OPERATORID = CP.operatorid
			and
					CPUSER.CPUSERID = UCORD.CPUSERID
		    AND 	
		    		UMCORD.CPUSERID = UCORD.CPUSERID
		    AND 
		    		UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		    AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND  
					UCORD.CHARGEMETHODID =0
		    UNION ALL
		    
		    SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  CARDUSER.CARDNUM CPUSERID,
				  CARDUSER.CARDUSERNAME CPUSERNAME,
				  CARDUSER.TELEPHONE,
				  CARDUSER.IDENTITYCARDNUM,
				  CARDUSER.PLATENUM PLATENUMBER,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.OPERATORID,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				 
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CARDUSER.VIN
			FROM 	
					USERCHARGERECORD UCORD,
				  OPERATORINFO CO,
				  CARDUSERINFO CARDUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
				cp.operatorid = co.operatorid
			and
				carduser.operatorid = co.operatorid
			and			
				CARDUSER.CARDNUM = UCORD.CARDNUM
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND  
					UCORD.CHARGEMETHODID =1) A
			ORDER BY A.CHARGESTARTTIME DESC
		  
	</select>
	
	<!-- 扫码用户信息-->
	<select id="selectByPage" parameterType="FindreportsDto"
		resultType="userReportsDto">
		SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  CPUSER.CPUSERID,
				  CPUSER.CPUSERNAME,
				  CPUSER.TELEPHONE,
				  CPUSER.PLATENUMBER,
				  0 IDENTITYCARDNUM,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.OPERATORID,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  <!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  <!-- UMCORD.REMAINMONEY, -->
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CPUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CPUSERINFO CPUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
				CO.OPERATORID = CP.OPERATORID
			AND
				CPUSER.CPUSERID = UCORD.CPUSERID
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
			AND	UCORD.CHARGEMETHODID = 0
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="OPERATORID!=null and OPERATORID!=''">
			AND 
					CO.OPERATORID = #{OPERATORID}
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			ORDER BY UCORD.CHARGESTARTTIME DESC
		   
	</select>
	
	<!-- 外部刷卡记录总数 -->
	<select id="getOuterCardCount" parameterType="FindreportsDto" resultType="Int">
		SELECT COUNT(*) FROM (SELECT 
						DISTINCT UCORD.TRANSATIONID,
						CARDUSER.CARDNUM CPUSERID,
						CARDUSER.CARDUSERNAME CPUSERNAME,
						CARDUSER.TELEPHONE,
						CARDUSER.IDENTITYCARDNUM,
						CARDUSER.PLATENUM PLATENUMBER,
						CASE UMCORD.DEDUCTSUCCESSFLAG
						WHEN 0 THEN '失败'
						ELSE '成功'END DEDUCTSUCCESSFLAG,
						CS.CSNAME,
						UCORD.DEVICEID,
					  	UCORD.CHARGEMETHODID,
					  	CHM.CHARGEMETHODNAME,
					  	UCORD.CHARGEMODEID,
					  	CMD.CHARGEMODENAME,
					  	UCORD.CHARGEENDCAUSE,
					  	UCORD.CHARGEQUANTITY,
					  	CS.CSID,
					  	CP.CPID,
					  	CP.CPNAME,
					  	CO.OPERATORID,
					  	(SELECT OPER.OPERATORNAME FROM OPERATORINFO OPER WHERE CARDUSER.OPERATORID = OPER.OPERATORID )OPERNAME,
					  	CO.OPERATORNAME,
					  	UMCORD.CHARGEMONEY,
					  	UMCORD.SERVICETIP,
					  	UMCORD.DEDUCTMONEY,
					  	LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
					  	FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
					 	CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
					  	(UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM,
					  	UMCORD.REMAINMONEY,
					  	CARDUSER.VIN
				FROM 
						USERCHARGERECORD UCORD,
						CARDUSERINFO CARDUSER,
						USERDEDUCTMONEYRECORD UMCORD,
						CPINFO CP,
						OPERATORINFO CO,
						CHARGEMODE CMD,
						CSINFO CS,CHARGEMETHOD CHM
				WHERE 	
						CP.OPERATORID = CO.OPERATORID
				AND
						CARDUSER.OPERATORID != CO.OPERATORID
				AND
						CARDUSER.CARDNUM = UCORD.CARDNUM
				AND 
						UMCORD.CPUSERID = UCORD.CPUSERID
				AND 
						UCORD.CPID = CP.CPID
				AND 
						CP.CSID = CS.CSID
				AND 
						CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
				AND 
						FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
				AND 	
						CMD.CHARGEMODEID = UCORD.CHARGEMODEID
				AND 
						UCORD.TRANSATIONID = UMCORD.TRANSATIONID
			    AND
						UCORD.CHARGEMETHODID = 1) A
		    WHERE 1=1
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="OPERATORID!=null and OPERATORID!=''">
			AND 
					A.OPERATORID = #{OPERATORID}
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>
	</select>
	
	<!-- !!!!!!!!!!!!!外部刷卡记录 -->
	<select id="selectOuterCardByPage" parameterType="FindreportsDto" resultType="userReportsDto">
		SELECT 
				DISTINCT UCORD.TRANSATIONID,
				CARDUSER.CARDNUM CPUSERID,
				CARDUSER.CARDUSERNAME CPUSERNAME,
				CARDUSER.TELEPHONE,
				CARDUSER.IDENTITYCARDNUM,
				CARDUSER.PLATENUM PLATENUMBER,
				CASE UMCORD.DEDUCTSUCCESSFLAG
				WHEN 0 THEN '失败'
				ELSE '成功'END DEDUCTSUCCESSFLAG,
				CS.CSNAME,
				UCORD.DEVICEID,
			  	UCORD.CHARGEMETHODID,
			  	CHM.CHARGEMETHODNAME,
			  	UCORD.CHARGEMODEID,
			  	CMD.CHARGEMODENAME,
			  	UCORD.CHARGEENDCAUSE,
			  	UCORD.CHARGEQUANTITY,
			  	CS.CSID,
			  	CP.CPID,
			  	CP.CPNAME,
			  	CO.OPERATORID,
			  	(SELECT OPER.OPERATORNAME FROM OPERATORINFO OPER WHERE CARDUSER.OPERATORID = OPER.OPERATORID )OPERNAME,
			  	CO.OPERATORNAME,
			  	UMCORD.CHARGEMONEY,
			  	UMCORD.SERVICETIP,
			  	UMCORD.DEDUCTMONEY,
			  	LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  	FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
			 	CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
			  	<!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
			  	UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
			  	<!-- UMCORD.REMAINMONEY, -->
			  	(UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
			  	CARDUSER.VIN
		FROM 
				USERCHARGERECORD UCORD,
				CARDUSERINFO CARDUSER,
				USERDEDUCTMONEYRECORD UMCORD,
				CPINFO CP,
				OPERATORINFO CO,
				CHARGEMODE CMD,
				CSINFO CS,CHARGEMETHOD CHM
		WHERE 	
				CP.OPERATORID = CO.OPERATORID
		AND
				CARDUSER.OPERATORID != CO.OPERATORID
		AND
				CARDUSER.CARDNUM = UCORD.CARDNUM
		AND 
				UMCORD.CPUSERID = UCORD.CPUSERID
		AND 
				UCORD.CPID = CP.CPID
		AND 
				CP.CSID = CS.CSID
		AND 
				CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		AND 
				FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		AND 	
				CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		AND 
				UCORD.TRANSATIONID = UMCORD.TRANSATIONID
	    AND
				UCORD.CHARGEMETHODID = 1
		ORDER BY 
				UCORD.CHARGESTARTTIME DESC
	</select>
	
	<!-- !!!!!!!!!!!!!外部刷卡记录导出 -->
	<select id="selectouter" parameterType="FindreportsDto" resultType="userReportsDto">
		SELECT 
				DISTINCT UCORD.TRANSATIONID,
				CARDUSER.CARDNUM CPUSERID,
				CARDUSER.CARDUSERNAME CPUSERNAME,
				CARDUSER.TELEPHONE,
				CARDUSER.IDENTITYCARDNUM,
				CARDUSER.PLATENUM PLATENUMBER,
				CASE UMCORD.DEDUCTSUCCESSFLAG
				WHEN 0 THEN '失败'
				ELSE '成功'END DEDUCTSUCCESSFLAG,
				CS.CSNAME,
				UCORD.DEVICEID,
			  	UCORD.CHARGEMETHODID,
			  	CHM.CHARGEMETHODNAME,
			  	UCORD.CHARGEMODEID,
			  	CMD.CHARGEMODENAME,
			  	UCORD.CHARGEENDCAUSE,
			  	UCORD.CHARGEQUANTITY,
			  	CS.CSID,
			  	CP.CPID,
			  	CP.CPNAME,
			  	CO.OPERATORID,
			  	(SELECT OPER.OPERATORNAME FROM OPERATORINFO OPER WHERE CARDUSER.OPERATORID = OPER.OPERATORID )OPERNAME,
			  	CO.OPERATORNAME,
			  	UMCORD.CHARGEMONEY,
			  	UMCORD.SERVICETIP,
			  	UMCORD.DEDUCTMONEY,
			  	LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  	FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
			 	CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
			  	<!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
			  	UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
			  	<!-- UMCORD.REMAINMONEY, -->
			  	(UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
			  	CARDUSER.VIN
		FROM 
				USERCHARGERECORD UCORD,
				CARDUSERINFO CARDUSER,
				USERDEDUCTMONEYRECORD UMCORD,
				CPINFO CP,
				OPERATORINFO CO,
				CHARGEMODE CMD,
				CSINFO CS,CHARGEMETHOD CHM
		WHERE 	
				CP.OPERATORID = CO.OPERATORID
		AND
				CARDUSER.OPERATORID != CO.OPERATORID
		AND
				CARDUSER.CARDNUM = UCORD.CARDNUM
		AND 
				UMCORD.CPUSERID = UCORD.CPUSERID
		AND 
				UCORD.CPID = CP.CPID
		AND 
				CP.CSID = CS.CSID
		AND 
				CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		AND 
				FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		AND 	
				CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		AND 
				UCORD.TRANSATIONID = UMCORD.TRANSATIONID
	    AND
				UCORD.CHARGEMETHODID = 1
		ORDER BY 
				UCORD.CHARGESTARTTIME DESC
	</select>
	
	<!-- 刷卡用户 -->
	<select id="selectCardByPage" parameterType="FindreportsDto"
		resultType="userReportsDto">
		SELECT 
				DISTINCT UCORD.TRANSATIONID,
				CARDUSER.CARDNUM CPUSERID,
				CARDUSER.CARDUSERNAME CPUSERNAME,
				CARDUSER.TELEPHONE,
				CARDUSER.IDENTITYCARDNUM,
				CARDUSER.PLATENUM PLATENUMBER,
				CASE UMCORD.DEDUCTSUCCESSFLAG
				WHEN 0 THEN '失败'
				ELSE '成功' END DEDUCTSUCCESSFLAG,
				CS.CSNAME,
				UCORD.DEVICEID,
				UCORD.CHARGEMETHODID,
				CHM.CHARGEMETHODNAME,
				UCORD.CHARGEMODEID,
				CMD.CHARGEMODENAME,
				UCORD.CHARGEENDCAUSE,
				UCORD.CHARGEQUANTITY,
				CS.CSID,
				CP.CPID,
				CO.OPERATORID,
				CO.OPERATORNAME,
				CP.CPNAME,
				UMCORD.CHARGEMONEY,
				UMCORD.SERVICETIP,
				UMCORD.DEDUCTMONEY,
				LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				<!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				<!-- UMCORD.REMAINMONEY, -->
				(UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				CARDUSER.VIN
		FROM 
				USERCHARGERECORD UCORD,
				CARDUSERINFO CARDUSER,
				OPERATORINFO CO,
				USERDEDUCTMONEYRECORD UMCORD,
				CPINFO CP,
				CHARGEMODE CMD,
				CSINFO CS,
				CHARGEMETHOD CHM
		WHERE 
				CP.OPERATORID = CO.OPERATORID
		AND
				CARDUSER.OPERATORID = CO.OPERATORID
		AND
				CARDUSER.CARDNUM = UCORD.CARDNUM
		AND 
				UMCORD.CPUSERID = UCORD.CPUSERID
		AND 
				UCORD.CPID = CP.CPID
		AND 
				CP.CSID = CS.CSID
		AND 
				CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		AND 
				FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		AND 
				CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		AND 
				UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		AND  
				UCORD.CHARGEMETHODID = 1
		<if test="OPERATORID!=null and OPERATORID!=''">
		AND  
				CO.OPERATORID = #{OPERATORID}
		</if>
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
		AND 
				CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
		</if>
		<if test="TELEPHONE!=null and TELEPHONE!=''">
		AND 
				CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
		</if>
		
		<if test="FROMDATE!=null and FROMDATE!=''">
	    AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
		</if>
		<if test="TODATE!=null and TODATE!=''">
		AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
		</if>	
		ORDER BY UCORD.CHARGESTARTTIME DESC
	   
	</select>
	
	
	<!-- all用户导出 -->
	<select id="selectAll" parameterType="FindreportsDto"
		resultType="userReportsDto">
		SELECT * FROM (SELECT 
				  UCORD.TRANSATIONID,
				  CPUSER.CPUSERID,
				  CPUSER.CPUSERNAME,
				  CPUSER.TELEPHONE,
				   0 IDENTITYCARDNUM,
				  CPUSER.PLATENUMBER,
				
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.operatorid,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  <!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  <!-- UMCORD.REMAINMONEY, -->
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CPUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CPUSERINFO CPUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,CHARGEMODE CMD,
				  OPERATORINFO CO,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
				cp.operatorid = co.operatorid
			and
				CPUSER.CPUSERID = UCORD.CPUSERID
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		    AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND  
					UCORD.CHARGEMETHODID =0
		    UNION ALL
		    
		    SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  CARDUSER.CARDNUM CPUSERID,
				  CARDUSER.CARDUSERNAME CPUSERNAME,
				  CARDUSER.TELEPHONE,
				  CARDUSER.IDENTITYCARDNUM,
				  CARDUSER.PLATENUM PLATENUMBER,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  co.operatorid,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  <!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  <!-- UMCORD.REMAINMONEY, -->
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CARDUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CARDUSERINFO CARDUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
				  cp.operatorid = co.operatorid
			and
				  carduser.operatorid = co.operatorid
			and
			CARDUSER.CARDNUM = UCORD.CARDNUM
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND  
					UCORD.CHARGEMETHODID =1) A
			WHERE 1=1
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="CPID!=null and CPID!=''">
			AND 
					A.CPID LIKE '%${CPID}%'
			</if>
			<if test="OPERATORNAME!=null and OPERATORNAME!=''">
			AND 
					A.OPERATORNAME LIKE '%${OPERATORNAME}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(A.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			ORDER BY A.CHARGESTARTTIME DESC
		    
	</select>
	
	<!--扫码用户导出 -->
	<select id="selectAllreports" parameterType="FindreportsDto" resultType="userReportsDto">
		SELECT 
				DISTINCT
				  UCORD.TRANSATIONID,
				  CPUSER.CPUSERID,
				  CPUSER.CPUSERNAME,
				  CPUSER.TELEPHONE,
				  CPUSER.PLATENUMBER,
				  0 IDENTITYCARDNUM,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  CO.OPERATORID,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  <!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  <!-- UMCORD.REMAINMONEY, -->
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CPUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CPUSERINFO CPUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE 
			CP.OPERATORID = CO.OPERATORID
			AND
			CPUSER.CPUSERID = UCORD.CPUSERID
		    AND UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
			AND  
					UCORD.CHARGEMETHODID = 0
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPID!=null and CPID!=''">
			AND
					CP.CPID LIKE '%${CPID}%'
			</if>
			<if test="OPERATORNAME!=null and OPERATORNAME!=''">
			AND 
					CO.OPERATORNAME LIKE '%${OPERATORNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			ORDER BY UCORD.CHARGESTARTTIME DESC
	</select>
	
	<!-- 刷卡用户导出 -->
	<select id="selectCardAllreports" parameterType="FindreportsDto"
		resultType="userReportsDto">
		SELECT DISTINCT
				  UCORD.TRANSATIONID,
				  CARDUSER.CARDNUM CPUSERID,
				  CARDUSER.CARDUSERNAME CPUSERNAME,
				  CARDUSER.TELEPHONE,
				  CARDUSER.IDENTITYCARDNUM,
				  CARDUSER.PLATENUM PLATENUMBER,
				  CASE UMCORD.DEDUCTSUCCESSFLAG
					WHEN 0 THEN '失败'
					ELSE '成功'
					 END DEDUCTSUCCESSFLAG,
				  CS.CSNAME,
				  UCORD.DEVICEID,
				  UCORD.CHARGEMETHODID,
				  CHM.CHARGEMETHODNAME,
				  UCORD.CHARGEMODEID,
				  CMD.CHARGEMODENAME,
				  UCORD.CHARGEENDCAUSE,
				  UCORD.CHARGEQUANTITY,
				  CS.CSID,
				  CP.CPID,
				  co.operatorid,
				  CO.OPERATORNAME,
				  CP.CPNAME,
				  UMCORD.CHARGEMONEY,
				  UMCORD.SERVICETIP,
				  UMCORD.DEDUCTMONEY,
				  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
				  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S') CHARGEENDTIME,
				  CONCAT(SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),1,2),"小时", SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),4,2),"分",SUBSTR(SEC_TO_TIME(UCORD.CHARGETIMESPAN),7),"秒")CHARGETIMESPAN,
				  <!-- (UMCORD.REMAINMONEY+UMCORD.DEDUCTMONEY)ACCOUNTSUM, -->
				  UCORD.BEFORECHARGEBALANCE ACCOUNTSUM,
				  <!-- UMCORD.REMAINMONEY, -->
				  (UCORD.BEFORECHARGEBALANCE - UMCORD.DEDUCTMONEY)REMAINMONEY,
				  CARDUSER.VIN
			FROM USERCHARGERECORD UCORD,
				  CARDUSERINFO CARDUSER,
				  USERDEDUCTMONEYRECORD UMCORD,
				  CPINFO CP,
				  OPERATORINFO CO,
				  CHARGEMODE CMD,
				  CSINFO CS,CHARGEMETHOD CHM
			WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		    AND 
		    	 cp.operatorid = co.operatorid
		    and
		    	 carduser.operatorid = co.operatorid
		    and
		    
		    	UMCORD.CPUSERID = UCORD.CPUSERID
		    AND UCORD.CPID = CP.CPID
		    AND CP.CSID = CS.CSID
		    AND CHM.CHARGEMETHODID = UCORD.CHARGEMETHODID
		     AND FIND_IN_SET(CS.OPERATORID, GetChildInfo(#{OPERATORLOGINID}))
		    AND CMD.CHARGEMODEID = UCORD.CHARGEMODEID
		    AND UCORD.TRANSATIONID = UMCORD.TRANSATIONID
			AND  
					UCORD.CHARGEMETHODID = 1
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPID!=null and CPID!=''">
			AND
					CP.CPID LIKE '%${CPID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="OPERATORNAME!=null and OPERATORNAME!=''">
			AND 
					CO.OPERATORNAME LIKE '%${OPERATORNAME}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			ORDER BY UCORD.CHARGESTARTTIME DESC
	</select>
</mapper>