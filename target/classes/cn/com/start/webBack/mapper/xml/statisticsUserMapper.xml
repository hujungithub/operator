<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.start.webBack.mapper.StatisticsUserMapper">
<!-- 所有用户总数 -->
<select id="getCount" parameterType="FindreportsDto" resultType="Int">
		SELECT COUNT(*) FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			AND UCORD.CHARGEMETHODID =  0
			GROUP BY CPUSER.CPUSERID
		UNION ALL	
			SELECT
	      CARDUSER.CARDNUM,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
		  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		AND UCORD.CHARGEMETHODID = 1
		GROUP BY CARDUSER.CARDNUM) A
		WHERE 1=1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					A.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
	</select>
	
<!-- 扫码用户总数 -->
	<select id="getCpCount" parameterType="FindreportsDto" resultType="Int">
		SELECT COUNT(*) FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  UCORD.CHARGEMETHODID,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			<if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CPUSER.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			GROUP BY CPUSER.CPUSERID) A
	</select>
	
	<!-- 刷卡用户总数 -->
	<select id="getCardCount" parameterType="FindreportsDto" resultType="Int">
		SELECT COUNT(*) FROM (SELECT
	      CARDUSER.CARDNUM,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM,
		  CARDUSER.TELEPHONE,
		  UCORD.CHARGEMETHODID,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(carduser.CardNum) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		<if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CARDUSER.CARDNUM LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>
			GROUP BY CARDUSER.CARDNUM	) A
	</select>
	<!-- 所有用户信息-->
	<select id="selectByPage" parameterType="FindreportsDto"
		resultType="UserChargeDto">
			SELECT * FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			AND UCORD.CHARGEMETHODID = 0
			GROUP BY CPUSER.CPUSERID
		UNION ALL	
			SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
		  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		AND UCORD.CHARGEMETHODID = 1
		GROUP BY CARDUSER.CARDNUM)A
		WHERE 1=1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					A.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
		    LIMIT
				#{startPos},#{pageSize}
	</select>
	
<!-- 扫码用户信息-->
	<select id="selectCpByPage" parameterType="FindreportsDto"
		resultType="UserChargeDto">
			SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CPUSER.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			GROUP BY CPUSER.CPUSERID
		    LIMIT
				#{startPos},#{pageSize}
	</select>
<!-- 刷卡用户信息 -->
	<select id="selectCardByPage" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CARDUSER.CARDNUM LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			GROUP BY CARDUSER.CARDNUM
		    LIMIT
				#{startPos},#{pageSize}
	</select>
	
	<!-- 所有用户总计 -->
	<select id="selectOperinfo" parameterType="FindreportsDto"
		resultType="UserChargeDto">
			SELECT CONCAT(SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
				SUM(CHARGEQUANTITY)CHARGEQUANTITY,SUM(CHARGEMONEY)CHARGEMONEY,SUM(SERVICETIP)SERVICETIP,SUM(CPUSERCOUNT)CPUSERCOUNT  
				FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
			  SUM(UCORD.CHARGETIMESPAN)CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			AND UCORD.CHARGEMETHODID = 0
			GROUP BY CPUSER.CPUSERID
		UNION ALL	
			SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
		  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
		  SUM(UCORD.CHARGETIMESPAN)CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		AND UCORD.CHARGEMETHODID = 1
		GROUP BY CARDUSER.CARDNUM)A
		WHERE 1=1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
		AND 
				A.CPUSERNAME LIKE '%${CPUSERNAME}%'
		</if>
		<if test="CPUSERID!=null and CPUSERID!=''">
		AND 
				A.CPUSERID LIKE '%${CPUSERID}%'
		</if>
		<if test="TELEPHONE!=null and TELEPHONE!=''">
		AND 
				A.TELEPHONE LIKE '%${TELEPHONE}%'
		</if>
		<if test="FROMDATE!=null and FROMDATE!=''">
	    AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
		</if>
		<if test="TODATE!=null and TODATE!=''">
		AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
		</if>	
			    LIMIT
					#{startPos},#{pageSize}
	</select>
	<!-- 扫码总计 -->
	<select id="selectCpOperinfo" parameterType="FindreportsDto"
		resultType="UserChargeDto">
			SELECT
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)   CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)    CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)    SERVICETIP,
			  COUNT(CPUSER.CPUSERID) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CPUSER.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
		    LIMIT
				#{startPos},#{pageSize}
	</select>
	<!-- 刷卡总计 -->
	<select id="selectCardOperinfo" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CARDUSER.CARDNUM LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
		    LIMIT
				#{startPos},#{pageSize}
	</select>
	<!-- 所有用户导出 -->
	<select id="selectAll" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT * FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			AND UCORD.CHARGEMETHODID = 0
			GROUP BY CPUSER.CPUSERID
		UNION ALL	
			SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
		  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		AND UCORD.CHARGEMETHODID = 1
		GROUP BY CARDUSER.CARDNUM)A
		WHERE 1=1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					A.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					A.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					A.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
	</select>
	<!-- 扫码用户导出 -->
<select id="selectCpAllreports" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CPUSER.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			GROUP BY CPUSER.CPUSERID
	</select>
	
	<!-- 刷卡用户导出 -->
	<select id="selectCardAllreports" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CARDUSER.CARDNUM LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
			GROUP BY CARDUSER.CARDNUM
	</select>
	<!-- 总计 -->
	<select id="selectAllCount" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT CONCAT(SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
				SUM(CHARGEQUANTITY)CHARGEQUANTITY,SUM(CHARGEMONEY)CHARGEMONEY,SUM(SERVICETIP)SERVICETIP,SUM(CPUSERCOUNT)CPUSERCOUNT  
				FROM (SELECT
		      CPUSER.CPUSERID,
			  CPUSER.CPUSERNAME,
			  CPUSER.PLATENUMBER,
			  CPUSER.TELEPHONE,
			  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
			  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
			  SUM(UCORD.CHARGETIMESPAN)CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)SERVICETIP,
			  COUNT(CPUSERNAME) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,
			  CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
			AND UCORD.CHARGEMETHODID = 0
			GROUP BY CPUSER.CPUSERID
		UNION ALL	
			SELECT
	      CARDUSER.CARDNUM CPUSERID,
		  CARDUSER.CARDUSERNAME CPUSERNAME,
		  CARDUSER.PLATENUM PLATENUMBER,
		  CARDUSER.TELEPHONE,
		  LEFT(UCORD.CHARGESTARTTIME,19)CHARGESTARTTIME,
		  FROM_UNIXTIME((UNIX_TIMESTAMP(UCORD.CHARGESTARTTIME)+UCORD.CHARGETIMESPAN),'%Y-%m-%d %H:%i:%S')    CHARGEENDTIME,
		  SUM(UCORD.CHARGETIMESPAN)CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		AND UCORD.CHARGEMETHODID = 1
		GROUP BY CARDUSER.CARDNUM)A
		WHERE 1=1
		<if test="CPUSERNAME!=null and CPUSERNAME!=''">
		AND 
				A.CPUSERNAME LIKE '%${CPUSERNAME}%'
		</if>
		<if test="CPUSERID!=null and CPUSERID!=''">
		AND 
				A.CPUSERID LIKE '%${CPUSERID}%'
		</if>
		<if test="TELEPHONE!=null and TELEPHONE!=''">
		AND 
				A.TELEPHONE LIKE '%${TELEPHONE}%'
		</if>
		<if test="FROMDATE!=null and FROMDATE!=''">
	    AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
		</if>
		<if test="TODATE!=null and TODATE!=''">
		AND
				 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
		</if>	
	</select>
	<!-- 扫码总计 -->
	<select id="selectCpAll" parameterType="FindreportsDto"
		resultType="UserChargeDto">
			SELECT
			  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
			  SUM(UCORD.CHARGEQUANTITY)   CHARGEQUANTITY,
			  SUM(UCORD.CHARGEMONEY)    CHARGEMONEY,
			  SUM(UCORD.SERVICETIP)    SERVICETIP,
			  COUNT(CPUSER.CPUSERID) CPUSERCOUNT
			FROM USERCHARGERECORD UCORD,CPUSERINFO CPUSER
			WHERE CPUSER.CPUSERID = UCORD.CPUSERID
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CPUSER.CPUSERID LIKE '%${CPUSERID}%'
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CPUSER.CPUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CPUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
	</select>
	<!-- 刷卡总计 -->
	<select id="selectCardAll" parameterType="FindreportsDto"
		resultType="UserChargeDto">
		SELECT
		  CONCAT(SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),1,2),"小时", SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),4,2),"分",SUBSTR(SEC_TO_TIME(SUM(UCORD.CHARGETIMESPAN)),7),"秒")CHARGETIMESPAN,
		  SUM(UCORD.CHARGEQUANTITY)CHARGEQUANTITY,
		  SUM(UCORD.CHARGEMONEY)CHARGEMONEY,
		  SUM(UCORD.SERVICETIP)SERVICETIP,
		  COUNT(CARDUSER.CARDNUM) CPUSERCOUNT
		FROM USERCHARGERECORD UCORD,
		  CARDUSERINFO CARDUSER
		WHERE CARDUSER.CARDNUM = UCORD.CARDNUM
		    <if test="CHARGEMETHODID!=null and CHARGEMETHODID!=''">
			AND  
					UCORD.CHARGEMETHODID = #{CHARGEMETHODID}
			</if>
			<if test="CPUSERNAME!=null and CPUSERNAME!=''">
			AND 
					CARDUSER.CARDUSERNAME LIKE '%${CPUSERNAME}%'
			</if>
			<if test="CPUSERID!=null and CPUSERID!=''">
			AND 
					CARDUSER.CARDNUM LIKE '%${CPUSERID}%'
			</if>
			<if test="TELEPHONE!=null and TELEPHONE!=''">
			AND 
					CARDUSER.TELEPHONE LIKE '%${TELEPHONE}%'
			</if>
			<if test="FROMDATE!=null and FROMDATE!=''">
		    AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &gt;= #{FROMDATE}
			</if>
			<if test="TODATE!=null and TODATE!=''">
			AND
					 STR_TO_DATE(UCORD.CHARGESTARTTIME, '%Y-%m-%d %H:%i') &lt;= #{TODATE}
			</if>	
	</select>
</mapper>